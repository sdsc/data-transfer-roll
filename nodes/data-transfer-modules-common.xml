<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
Data-Transfer roll module files
BBFTP
http://doc.in2p3.fr/bbftp
BBCP
http://www.slac.stanford.edu/~abh/bbcp
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<post>

# Remove /etc/profile.d files in favor of loadable modules when available
if test -f /etc/profile.d/bbftp.sh; then

  /bin/rm -f /etc/profile.d/bbftp.* /etc/profile.d/bbcp.*

  if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.csh` = 0; then
    echo 'setenv MODULEPATH /opt/modulefiles/applications:$MODULEPATH' >> \
         /etc/profile.d/modules.csh
    echo 'if ( -s ${HOME}/.modules ) then' >> /etc/profile.d/modules.csh
    echo 'source ${HOME}/.modules' >> /etc/profile.d/modules.csh
    echo 'endif' >> /etc/profile.d/modules.csh

  fi
  if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.sh` = 0; then
    echo 'export MODULEPATH=/opt/modulefiles/applications:$MODULEPATH' >> \
         /etc/profile.d/modules.sh
    echo 'if test -f ${HOME}/.modules; then' >> /etc/profile.d/modules.sh
    echo '. ${HOME}/.modules' >> /etc/profile.d/modules.sh
    echo 'fi' >> /etc/profile.d/modules.sh
  fi

# BBFTP

  /bin/mkdir -m 0755 -p /opt/modulefiles/applications/bbftp

<file name="/opt/modulefiles/applications/bbftp/320" perms="0644">
#%Module1.0
prepend-path PATH /opt/bbftp/bin
</file>
<file name="/opt/modulefiles/applications/bbftp/.version.320">
#%Module1.0
set ModulesVersion "320"
</file>

  /bin/ln -s /opt/modulefiles/applications/bbftp/.version.320 \
             /opt/modulefiles/applications/bbftp/.version

# BBCP

  /bin/mkdir -m 0755 -p /opt/modulefiles/applications/bbcp

<file name="/opt/modulefiles/applications/bbcp/10.08.29" perms="0644">
#%Module1.0
prepend-path PATH /opt/bbcp/bin
</file>
<file name="/opt/modulefiles/applications/bbftp/.version.10.08.29">
#%Module1.0
set ModulesVersion "10.08.29"
</file>

  /bin/ln -s /opt/modulefiles/applications/bbftp/.version.10.08.29 \
             /opt/modulefiles/applications/bbftp/.version

fi

</post>

</kickstart>
